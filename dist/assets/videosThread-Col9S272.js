/* empty css               *//* empty css              *//* empty css             */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function i(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=i(o);fetch(o.href,s)}})();class d{constructor(e){this.config=e,this.isRunning=!1}async start(){console.log("üì∫ Using fallback scheduler"),this.isRunning=!0}async stop(){this.isRunning=!1}}class a{constructor(){this.videos=[],this.currentVideoIndex=0,this.volume=50,this.isPlaying=!1,this.isBuffering=!1,this.schwelevision=null,this.currentScheduledVideo=null,this.adBreaks=[],this.isAdPlaying=!1,this.loopSchedule=[],this.loopDuration=24*60*60*1e3,this.epochStart=Date.now(),this.currentProgramIndex=0,this.videoElement=null,this.nowPlaying=null,this.loadingText=null,this.initializeSchwelevision()}async initializeSchwelevision(){console.log("üì∫ Using fallback scheduler"),this.schwelevision=new d({videoElement:"tvVideo",nowPlayingElement:"nowPlaying",loadingElement:"loadingText",schedulePath:"/public/schedule_weeks/",fallbackContent:!0});try{await this.schwelevision.start(),console.log("‚úÖ Fallback scheduler initialized successfully")}catch(e){console.error("‚ùå Failed to initialize scheduler:",e)}}async initialize(){if(console.log("üöÄ Initializing Enhanced Video Player with 420kit Schwelevision..."),this.videoElement=document.getElementById("tvVideo"),this.nowPlaying=document.getElementById("nowPlaying"),this.loadingText=document.getElementById("loadingText"),!this.videoElement){console.error("‚ùå Video element not found");return}console.log("‚úÖ Enhanced Video Player initialized with 420kit Schwelevision"),await this.startVideoSystem()}async startVideoSystem(){console.log("üì∫ Starting video system..."),this.loadingText&&(this.loadingText.textContent="INITIALIZING QUANTUM STREAM...");try{if(this.setupVideoPlayer(),await this.loadVideos(),this.videos.length===0)throw new Error("No videos loaded");await this.startHybridBroadcast(),this.loadingText&&(this.loadingText.textContent="QUANTUM STREAM ACTIVE"),console.log("‚úÖ Video system started successfully")}catch(e){console.error("‚ùå Error starting video system:",e);try{await this.playNextVideo(),this.loadingText&&(this.loadingText.textContent="QUANTUM STREAM ACTIVE"),console.log("‚úÖ Video system started with fallback")}catch(i){console.error("‚ùå Fallback also failed:",i),this.loadingText&&(this.loadingText.textContent="QUANTUM STREAM ERROR")}}}setupVideoPlayer(){this.videoElement.addEventListener("loadedmetadata",()=>{console.log("üì∫ Video metadata loaded"),this.isBuffering=!1,this.loadingText&&(this.loadingText.style.display="none")}),this.videoElement.addEventListener("canplay",()=>{console.log("üì∫ Video can play")}),this.videoElement.addEventListener("error",e=>{console.error("‚ùå Video error:",e),this.handleVideoError(e)}),this.videoElement.addEventListener("ended",()=>{console.log("üì∫ Video ended"),this.playNextVideo()}),this.videoElement.addEventListener("timeupdate",()=>{this.checkForAdBreaks()})}async loadVideos(){try{const e=await fetch("/saved_videos.json");if(!e.ok)throw new Error("Failed to fetch videos");const i=await e.json();this.videos=Object.keys(i).map(t=>({filename:t,...i[t]})),console.log(`üìº Loaded ${this.videos.length} videos`),this.scheduler&&(this.scheduler.savedVideos=i)}catch(e){console.error("‚ùå Error loading videos:",e),this.videos=[]}}createLoopSchedule(){if(this.videos.length===0)return;this.loopSchedule=[];let e=0;for(;e<this.loopDuration;)for(const i of this.videos){if(e>=this.loopDuration)break;const t=(i.duration||30)*1e3;this.loopSchedule.push({filename:i.filename,duration:t,offsetMs:e,videoIndex:this.videos.findIndex(o=>o.filename===i.filename)}),e+=t+2e3}console.log(`üì∫ Created loop schedule with ${this.loopSchedule.length} slots`)}async startHybridBroadcast(){console.log("üì° Starting hybrid broadcast...");try{console.log("üì∫ Playing regular programming with fallback scheduler"),await this.playNextVideo()}catch(e){console.error("‚ùå Error starting broadcast:",e),await this.playNextVideo()}}async playScheduledVideo(e){this.currentScheduledVideo=e,this.adBreaks=e.adBreaks||[];const i=e.u||`/saved_videos/${e.filename}`;console.log(`üìÖ Playing scheduled video with priority URL: ${i}`),console.log(`üìÖ Video source: ${e.u?"External archive.org":"Local fallback"}`);try{const t=document.createElement("video");if(t.src=i,t.volume=0,t.muted=!0,await new Promise((o,s)=>{const n=setTimeout(()=>{s(new Error("Video loading timeout"))},1e4);t.addEventListener("loadedmetadata",()=>{clearTimeout(n),o()},{once:!0}),t.addEventListener("error",l=>{clearTimeout(n),s(l)},{once:!0}),t.load()}),t.duration&&!isNaN(t.duration))this.videoElement.src=i,this.videoElement.currentTime=e.position||0,this.videoElement.volume=this.volume/100,this.videoElement.muted=this.volume===0,await this.videoElement.play(),this.isPlaying=!0,this.updateNowPlaying(e,"scheduled"),console.log(`üìÖ Playing scheduled video: ${e.show||e.filename}`),console.log(`üìÖ Source: ${i}`);else throw new Error("Video has no duration or invalid")}catch(t){console.error("‚ùå Error playing scheduled video:",t),console.log(`üìÖ Failed to load: ${i}`),console.log("üìÖ Falling back to saved videos..."),await this.playNextVideo()}}async playNextVideo(){this.currentScheduledVideo=null,this.adBreaks=[],this.isAdPlaying=!1;const e=await this.scheduler?.getNextVideo();if(e&&e.source!=="saved_videos")e.source==="scheduled"?await this.playScheduledVideo(e):await this.playVideo(e);else{const o=(Date.now()-this.epochStart)%this.loopDuration,s=this.loopSchedule.find(n=>o>=n.offsetMs&&o<n.offsetMs+n.duration);if(s){this.currentProgramIndex=this.loopSchedule.indexOf(s);const n=this.videos[s.videoIndex];await this.playVideo(n)}else{this.currentProgramIndex=(this.currentProgramIndex+1)%this.loopSchedule.length;const n=this.loopSchedule[this.currentProgramIndex],l=this.videos[n.videoIndex];await this.playVideo(l)}}}async playVideo(e){if(!e||!e.filename&&!e.path){console.error("‚ùå Invalid video data");return}try{let i;e.source==="static"?i="/static.mp4":i=e.path||`/saved_videos/${e.filename}`,this.videoElement.src=i,this.videoElement.volume=this.volume/100,this.videoElement.muted=this.volume===0,await this.videoElement.play(),this.isPlaying=!0,this.updateNowPlaying(e,e.source||"regular");const t=e.title||e.filename||(e.path?e.path.split("/").pop():"Unknown");console.log(`üì∫ Playing video: ${t} from ${i}`)}catch(i){console.error("‚ùå Error playing video:",i),this.handleVideoError(i)}}checkForAdBreaks(){if(!this.adBreaks||this.adBreaks.length===0||this.isAdPlaying)return;const e=this.videoElement.currentTime,i=this.adBreaks.find(t=>Math.abs(t.position-e)<1&&!t.played);i&&this.playAdBreak(i)}async playAdBreak(e){console.log("üì∫ Playing ad break"),e.played=!0,this.isAdPlaying=!0;const i=this.videoElement.currentTime,t=this.videoElement.volume;try{await this.playVideo(e.video),this.updateNowPlaying(e.video,"ad"),setTimeout(async()=>{this.isAdPlaying=!1,this.currentScheduledVideo?(this.videoElement.currentTime=i,this.videoElement.volume=t,await this.videoElement.play(),this.updateNowPlaying(this.currentScheduledVideo,"scheduled")):await this.playNextVideo()},(e.video.duration||30)*1e3)}catch(o){console.error("‚ùå Error playing ad:",o),this.isAdPlaying=!1,this.videoElement.currentTime=i,this.videoElement.volume=t,await this.videoElement.play()}}updateNowPlaying(e,i){if(!this.nowPlaying)return;let t="üì∫",o="";switch(i){case"scheduled":t="üìÖ",o="SCHEDULED";break;case"scheduled-local":t="üìÖ",o="SCHEDULED (LOCAL)";break;case"ad":t="üì¢",o="ADVERTISEMENT";break;case"saved_videos":t="üìº",o="SAVED CLIP";break;case"static":t="üì∫",o="STATIC/NOISE";break;default:t="üì∫",o="REGULAR"}const s=e.show||e.title||e.filename||"Unknown";this.nowPlaying.innerHTML=`${t} NOW PLAYING: ${s} [${o}]`}handleVideoError(e){console.error("‚ùå Video playback error:",e),setTimeout(()=>{this.playNextVideo()},2e3)}getSchedulerStatus(){return this.schwelevision?.getStatus()||{hasWeeklySchedule:!1,hasSavedVideos:!1,hasStaticSchedule:!1,isScheduledVideoPlaying:!!this.currentScheduledVideo,isBufferingScheduledVideo:!1,schwelevisionActive:!!this.schwelevision}}async checkForScheduledContent(){if(!this.schwelevision)return;const e=this.schwelevision.getStatus();console.log("üìÖ Schwelevision status:",e)}}window.EnhancedVideoPlayer=a;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.videoPlayer=new a,window.videoPlayer.initialize(),window.tv=window.videoPlayer}):(window.videoPlayer=new a,window.videoPlayer.initialize(),window.tv=window.videoPlayer);
