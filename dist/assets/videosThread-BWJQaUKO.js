/* empty css               *//* empty css              *//* empty css             */(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();class d{constructor(e){this.config=e,this.isRunning=!1}async start(){console.log("üì∫ Using fallback scheduler"),this.isRunning=!0}async stop(){this.isRunning=!1}}class a{constructor(){this.videos=[],this.currentVideoIndex=0,this.volume=50,this.isPlaying=!1,this.isBuffering=!1,this.schwelevision=null,this.currentScheduledVideo=null,this.adBreaks=[],this.isAdPlaying=!1,this.loopSchedule=[],this.loopDuration=24*60*60*1e3,this.epochStart=Date.now(),this.currentProgramIndex=0,this.videoElement=null,this.nowPlaying=null,this.loadingText=null,this.initializeSchwelevision()}async initializeSchwelevision(){console.log("üì∫ Using fallback scheduler"),this.schwelevision=new d({videoElement:"tvVideo",nowPlayingElement:"nowPlaying",loadingElement:"loadingText",schedulePath:"/public/schedule_weeks/",fallbackContent:!0});try{await this.schwelevision.start(),console.log("‚úÖ Fallback scheduler initialized successfully")}catch(e){console.error("‚ùå Failed to initialize scheduler:",e)}}async initialize(){if(console.log("üöÄ Initializing Enhanced Video Player with 420kit Schwelevision..."),this.videoElement=document.getElementById("tvVideo"),this.nowPlaying=document.getElementById("nowPlaying"),this.loadingText=document.getElementById("loadingText"),!this.videoElement){console.error("‚ùå Video element not found");return}console.log("‚úÖ Enhanced Video Player initialized with 420kit Schwelevision")}setupVideoPlayer(){this.videoElement.addEventListener("loadedmetadata",()=>{console.log("üì∫ Video metadata loaded"),this.isBuffering=!1,this.loadingText&&(this.loadingText.style.display="none")}),this.videoElement.addEventListener("canplay",()=>{console.log("üì∫ Video can play")}),this.videoElement.addEventListener("error",e=>{console.error("‚ùå Video error:",e),this.handleVideoError(e)}),this.videoElement.addEventListener("ended",()=>{console.log("üì∫ Video ended"),this.playNextVideo()}),this.videoElement.addEventListener("timeupdate",()=>{this.checkForAdBreaks()})}async loadVideos(){try{const e=await fetch("/saved_videos.json");if(!e.ok)throw new Error("Failed to fetch videos");const t=await e.json();this.videos=Object.keys(t).map(i=>({filename:i,...t[i]})),console.log(`üìº Loaded ${this.videos.length} videos`),this.scheduler&&(this.scheduler.savedVideos=t)}catch(e){console.error("‚ùå Error loading videos:",e),this.videos=[]}}createLoopSchedule(){if(this.videos.length===0)return;this.loopSchedule=[];let e=0;for(;e<this.loopDuration;)for(const t of this.videos){if(e>=this.loopDuration)break;const i=(t.duration||30)*1e3;this.loopSchedule.push({filename:t.filename,duration:i,offsetMs:e,videoIndex:this.videos.findIndex(o=>o.filename===t.filename)}),e+=i+2e3}console.log(`üì∫ Created loop schedule with ${this.loopSchedule.length} slots`)}async startHybridBroadcast(){console.log("üì° Starting hybrid broadcast...");try{const e=await this.scheduler?.getNextVideo();e&&e.source==="scheduled"?(console.log("üìÖ Playing scheduled content"),await this.playScheduledVideo(e)):(console.log("üì∫ No scheduled content, playing regular programming"),await this.playNextVideo())}catch(e){console.error("‚ùå Error starting broadcast:",e),await this.playNextVideo()}}async playScheduledVideo(e){this.currentScheduledVideo=e,this.adBreaks=e.adBreaks||[];const t=e.u||`/saved_videos/${e.filename}`;console.log(`üìÖ Playing scheduled video with priority URL: ${t}`),console.log(`üìÖ Video source: ${e.u?"External archive.org":"Local fallback"}`);try{const i=document.createElement("video");if(i.src=t,i.volume=0,i.muted=!0,await new Promise((o,s)=>{const n=setTimeout(()=>{s(new Error("Video loading timeout"))},1e4);i.addEventListener("loadedmetadata",()=>{clearTimeout(n),o()},{once:!0}),i.addEventListener("error",l=>{clearTimeout(n),s(l)},{once:!0}),i.load()}),i.duration&&!isNaN(i.duration))this.videoElement.src=t,this.videoElement.currentTime=e.position||0,this.videoElement.volume=this.volume/100,this.videoElement.muted=this.volume===0,await this.videoElement.play(),this.isPlaying=!0,this.updateNowPlaying(e,"scheduled"),console.log(`üìÖ Playing scheduled video: ${e.show||e.filename}`),console.log(`üìÖ Source: ${t}`);else throw new Error("Video has no duration or invalid")}catch(i){console.error("‚ùå Error playing scheduled video:",i),console.log(`üìÖ Failed to load: ${t}`),console.log("üìÖ Falling back to saved videos..."),await this.playNextVideo()}}async playNextVideo(){this.currentScheduledVideo=null,this.adBreaks=[],this.isAdPlaying=!1;const e=await this.scheduler?.getNextVideo();if(e&&e.source!=="saved_videos")e.source==="scheduled"?await this.playScheduledVideo(e):await this.playVideo(e);else{const o=(Date.now()-this.epochStart)%this.loopDuration,s=this.loopSchedule.find(n=>o>=n.offsetMs&&o<n.offsetMs+n.duration);if(s){this.currentProgramIndex=this.loopSchedule.indexOf(s);const n=this.videos[s.videoIndex];await this.playVideo(n)}else{this.currentProgramIndex=(this.currentProgramIndex+1)%this.loopSchedule.length;const n=this.loopSchedule[this.currentProgramIndex],l=this.videos[n.videoIndex];await this.playVideo(l)}}}async playVideo(e){if(!e||!e.filename){console.error("‚ùå Invalid video data");return}try{let t;e.source==="static"?t="/static.mp4":t=`/saved_videos/${e.filename}`,this.videoElement.src=t,this.videoElement.volume=this.volume/100,this.videoElement.muted=this.volume===0,await this.videoElement.play(),this.isPlaying=!0,this.updateNowPlaying(e,e.source||"regular"),console.log(`üì∫ Playing video: ${e.title||e.filename} from ${t}`)}catch(t){console.error("‚ùå Error playing video:",t),this.handleVideoError(t)}}checkForAdBreaks(){if(!this.adBreaks||this.adBreaks.length===0||this.isAdPlaying)return;const e=this.videoElement.currentTime,t=this.adBreaks.find(i=>Math.abs(i.position-e)<1&&!i.played);t&&this.playAdBreak(t)}async playAdBreak(e){console.log("üì∫ Playing ad break"),e.played=!0,this.isAdPlaying=!0;const t=this.videoElement.currentTime,i=this.videoElement.volume;try{await this.playVideo(e.video),this.updateNowPlaying(e.video,"ad"),setTimeout(async()=>{this.isAdPlaying=!1,this.currentScheduledVideo?(this.videoElement.currentTime=t,this.videoElement.volume=i,await this.videoElement.play(),this.updateNowPlaying(this.currentScheduledVideo,"scheduled")):await this.playNextVideo()},(e.video.duration||30)*1e3)}catch(o){console.error("‚ùå Error playing ad:",o),this.isAdPlaying=!1,this.videoElement.currentTime=t,this.videoElement.volume=i,await this.videoElement.play()}}updateNowPlaying(e,t){if(!this.nowPlaying)return;let i="üì∫",o="";switch(t){case"scheduled":i="üìÖ",o="SCHEDULED";break;case"scheduled-local":i="üìÖ",o="SCHEDULED (LOCAL)";break;case"ad":i="üì¢",o="ADVERTISEMENT";break;case"saved_videos":i="üìº",o="SAVED CLIP";break;case"static":i="üì∫",o="STATIC/NOISE";break;default:i="üì∫",o="REGULAR"}const s=e.show||e.title||e.filename||"Unknown";this.nowPlaying.innerHTML=`${i} NOW PLAYING: ${s} [${o}]`}handleVideoError(e){console.error("‚ùå Video playback error:",e),setTimeout(()=>{this.playNextVideo()},2e3)}getSchedulerStatus(){return this.schwelevision?.getStatus()||{hasWeeklySchedule:!1,hasSavedVideos:!1,hasStaticSchedule:!1,isScheduledVideoPlaying:!!this.currentScheduledVideo,isBufferingScheduledVideo:!1,schwelevisionActive:!!this.schwelevision}}async checkForScheduledContent(){if(!this.schwelevision)return;const e=this.schwelevision.getStatus();console.log("üìÖ Schwelevision status:",e)}}window.EnhancedVideoPlayer=a;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.videoPlayer=new a,window.videoPlayer.initialize()}):(window.videoPlayer=new a,window.videoPlayer.initialize());
